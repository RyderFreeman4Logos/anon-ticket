# TODO

## Pending
- [x] **Immediate-1** Bootstrap the Cargo workspace with root `Cargo.toml`, shared lint settings, and stub crates for API, monitor, and domain logic so that future work is cleanly modularized – Tests: add smoke `cargo test --all --all-features`/`cargo clippy --workspace --all-features` CI jobs plus unit tests ensuring each crate compiles with required features – Docs: expand `README.md` with the workspace layout diagram and command matrix, and inline crate-level `//!` docs describing responsibilities – Risks/Deps: selecting crate boundaries too early could cause churn; capture assumptions in `design_docs/` for review.
- [x] **Immediate-2** Establish deterministic environment plumbing (Rust toolchain pin, `.env.example`, sample `config/` secrets flow) and wire up `sha3` + `dotenvy` crates across workspace to keep hashing and configuration consistent – Tests: add config parsing unit tests plus a `cargo test` guard verifying `.env` loading from fixtures – Docs: document environment variables in README tables and annotate `.env.example` – Risks/Deps: ensure secrets are never committed by extending `.gitignore` and adding a pre-commit note.
- [x] **ShortTerm-3** Define the storage abstraction layer (`PaymentStore`, `TokenStore`, `MonitorStateStore`) and deliver the initial SQLite-backed adapter covering migrations and connection pooling – Tests: use `sqlx::test` or TempDir-backed integration tests to exercise CRUD flows and transactional guarantees – Docs: generate module-level docs explaining trait contracts and add migration walkthroughs to README – Risks/Deps: confirm `sqlx` offline data is checked in to keep CI deterministic.
- [x] **ShortTerm-4** Implement the PID validation and token derivation helpers (enforcing 32-char hex + SHA3-256) as a shared domain module to guarantee all components apply identical security checks – Tests: property tests ensuring invalid PIDs are rejected plus unit tests comparing hash outputs to vectors – Docs: add `///` docs with examples and update README security model section – Risks/Deps: highlight entropy requirements to avoid weak client implementations.
- [x] **ShortTerm-5** Build the Actix `POST /api/v1/redeem` endpoint that uses the storage trait for atomic claim updates and emits deterministic service tokens – Tests: request-level integration tests (Actix test server) that cover success, duplicate, and invalid PID paths – Docs: extend API reference in README (request/response schemas) and include tracing annotations in code comments – Risks/Deps: ensure DB transactions roll back on network failures; add error taxonomy upfront.
- [ ] **MidTerm-6** Ship the monitor service crate that tails `monero-wallet-rpc`, persists qualifying transfers through the storage trait, and tracks height via `MonitorStateStore` without hardcoded defaults – Tests: async integration tests with mocked RPC responses plus regression tests for resume-from-height – Docs: architecture note in `docs/` describing polling cadence and failure recovery – Risks/Deps: requires RPC endpoint availability; design retry/backoff strategy.
- [ ] **MidTerm-7** Introduce the caching/bloom-filter abstraction (trait-based) with an in-memory MVP to screen obvious invalid PIDs before hitting storage, paving the way for moka/Redis implementations – Tests: unit tests covering false-positive bounds and eviction plus integration tests verifying cache bypass falls back to DB – Docs: README section comparing cache strategies and inline notes on tuning false-positive rates – Risks/Deps: guard against cache becoming DoS vector by specifying quotas.
- [ ] **MidTerm-8** Provide introspection and revocation APIs (`GET /api/v1/token/{token}`, `POST /api/v1/token/{token}/revoke`) backed by the token store with auditing fields populated – Tests: HTTP integration tests covering active, revoked, and missing tokens along with auth failure permutations – Docs: document operational playbooks for revocation and add OpenAPI snippets – Risks/Deps: define auth story (mTLS or static keys) before exposing endpoints.
- [ ] **LongTerm-9** Layer in observability and abuse detection (structured tracing, metrics, abuse score escalation, dashboarding hooks) so production deployments can detect DoS or misuse early – Tests: telemetry snapshot tests plus load-test scripts to validate metrics fidelity – Docs: operations guide covering alert thresholds and tracing conventions – Risks/Deps: depends on earlier API + monitor milestones; coordinate with infra for metrics backend.

## Plan Summary
Focus immediately on foundational scaffolding (workspace + config) so every crate compiles and shares deterministic settings, then tackle storage/domain correctness before exposing Actix APIs and monitor loops; parallel test strategy leans on unit/property tests for validation logic, sqlx-backed integration for persistence, and Actix service tests for endpoints, while documentation updates accompany each milestone via README sections, module docs, and dedicated architecture notes to keep contributors aligned.
