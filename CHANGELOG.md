1a571bf6 chore(repo): add workspace gitignore
Established a baseline `.gitignore` that covers Cargo builds, wasm-pack artifacts, IDE clutter, and local configuration in order to keep future Rust worktree clean despite the current minimal file set. Documented why several project-specific paths (matrix bot configs, proto outputs, drafts) remain untracked so contributors know where to place sensitive data without risking accidental commits. Highlighted the intent to pair every public English log with a private Chinese mirror while keeping the mirror ignored so bi-lingual context is preserved locally without polluting history; future entries should follow the same diary style.
af31d54 docs(todo): seed project roadmap
Outlined a tiered roadmap in `TODO.md` that bridges the high-level blueprint from `drafts/dev.md` with concrete, test-first tasks. Prioritized workspace scaffolding and deterministic environment setup as immediate items so later crates inherit consistent tooling, then layered storage, validation, API, monitor, caching, and observability milestones with explicit testing (sqlx integration, Actix HTTP harnesses, property tests) and documentation requirements (README sections, module docs, architecture notes). The checklist also encodes risk callouts—like trait abstraction churn, RPC availability, and cache DoS potential—to keep future contributors aware while enabling modular backends (SQLite now, Redis/moka later).
2702e1a feat(workspace): bootstrap cargo workspace
Stood up the multi-crate workspace with resolver 2, shared package metadata, and lint/format configs so every crate inherits the same rules. Added placeholder API/monitor binaries plus a domain crate that exposes `workspace_ready_message`, wiring the binaries through it to prove dependencies compile end-to-end. Documented the workspace layout/commands in `README.md`, ticked the Immediate-1 entry in `TODO.md`, and validated the scaffold by running `cargo fmt --all`, `cargo clippy --workspace --all-features -- -D warnings`, and `cargo test --all --all-features` from the root.
dbfc2f0 feat(env): add deterministic config plumbing
Pinned the toolchain via `rust-toolchain.toml`, introduced `.env.example`, and documented the `config/` secrets workflow so every crate consumes the same deterministic environment. Extended the workspace manifest with shared `dotenvy`/`sha3`/`hex`/`thiserror` deps, taught the domain crate to expose `BootstrapConfig`, `ConfigError`, and a SHA3-256 PID fingerprint helper, and updated the API + monitor binaries to call those routines. README now explains the environment setup, TODO reflects Immediate-2 completion, and `.gitignore` shields secrets while `config/README.md` captures expectations. Verified everything with `CARGO_HOME=$PWD/.cargo-local RUSTUP_HOME=$PWD/.rustup-local cargo fmt --all`, `cargo clippy --workspace --all-features -- -D warnings`, and `cargo test --all --all-features`.
1895cbe chore(toolchain): bump rust to 1.91.1
Upgraded the workspace to Rust 1.91.1 via `rust-toolchain.toml` and reflected the change in README so contributors install the latest stable toolchain. Verified compatibility by running `CARGO_HOME=$PWD/.cargo-local RUSTUP_HOME=$PWD/.rustup-local cargo fmt --all`, `cargo clippy --workspace --all-features -- -D warnings`, and `cargo test --all --all-features` on the new release.
6dcb33c feat(storage): add seaorm repository layer
Introduced the trait-based storage contracts in `anon_ticket_domain::storage` (PID/service token newtypes, storage errors, async traits) and wired them into the new `anon_ticket_storage` crate. The SeaORM adapter now runs schema migrations for SQLite/optional Postgres, offers a single `SeaOrmStorage::connect` helper, and ships integration tests that exercise payment claiming, token issuance/revocation, and monitor height persistence. README documents how to toggle between SQLite and Postgres features, and the ShortTerm-3 TODO item is checked off to reflect the completed storage milestone.
a992d88 fix(storage): atomically guard payment claims
Hardened `SeaOrmStorage::claim_payment` so that it performs a single atomic `UPDATE ... WHERE status = 'unclaimed'` before reading back the row, preventing concurrent claimers from double-spending the same PID. Added a regression test that launches two async claimers and asserts only one succeeds, ensuring the guard works under real concurrency. Verified the change with `CARGO_HOME=$PWD/.cargo-local RUSTUP_HOME=$PWD/.rustup-local cargo fmt --all`, `cargo clippy --workspace --all-features -- -D warnings`, and `cargo test --all --all-features`.
da571d8 fix(storage): gate tests per backend feature
Adjusted the `anon_ticket_storage` test suite to respect whichever SeaORM backend feature is enabled: SQLite runs against the in-memory DSN, while Postgres relies on a `TEST_POSTGRES_URL` env var, and unsupported combos skip tests with a clear message. README now explains how to set that env var before using the documented Postgres command. Validated the change with `CARGO_HOME=$PWD/.cargo-local RUSTUP_HOME=$PWD/.rustup-local cargo fmt --all`, `cargo clippy --workspace --all-features -- -D warnings`, and `cargo test --all --all-features`.
02f3e77 feat(domain): add pid validation and token helpers
Introduced `validate_pid`, `PaymentId::parse`, and `derive_service_token` so every crate can enforce the 32-character hex PID contract and derive SHA3-based service tokens consistently. The helpers ship unit tests that check invalid inputs, parsing, and deterministic outputs, plus README guidance encouraging callers to use the new APIs. Also ticked ShortTerm-4 in TODO.md to reflect the completed milestone. Validated via `CARGO_HOME=$PWD/.cargo-local RUSTUP_HOME=$PWD/.rustup-local cargo fmt --all`, `cargo clippy --workspace --all-features -- -D warnings`, and `cargo test --all --all-features`.
1e76921 chore(domain): format pid validation test
Lightly reformatted the `pid_validation_rejects_invalid_inputs` assertion so the long hex string comparison is multi-line and easier to diff/scan during future edits. No behavior change, but keeps the growing domain helper tests consistent with rustfmt output.
